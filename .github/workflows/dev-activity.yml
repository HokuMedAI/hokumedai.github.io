name: Dev Activity

on:
  issues:
    types: [opened, closed, reopened]
  pull_request:
    types: [opened, closed, merged, reopened, ready_for_review]
  pull_request_review:
    types: [submitted]
  release:
    types: [published]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Issue Notifications
        if: github.event_name == 'issues'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_DEV }}
        run: |
          ACTION="${{ github.event.action }}"
          ISSUE_TITLE="${{ github.event.issue.title }}"
          ISSUE_NUMBER="${{ github.event.issue.number }}"
          ISSUE_URL="${{ github.event.issue.html_url }}"
          USER="${{ github.event.issue.user.login }}"
          
          case "$ACTION" in
            "opened")
              EMOJI="ğŸ›"
              ACTION_TEXT="æ–°ã—ã„issueãŒä½œæˆã•ã‚Œã¾ã—ãŸ"
              COLOR=15844367
              ;;
            "closed")
              EMOJI="âœ…"
              ACTION_TEXT="issueãŒã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã—ãŸ"
              COLOR=5763719
              ;;
            "reopened")
              EMOJI="ğŸ”„"
              ACTION_TEXT="issueãŒå†ã‚ªãƒ¼ãƒ—ãƒ³ã•ã‚Œã¾ã—ãŸ"
              COLOR=15844367
              ;;
          esac
          
          curl -H "Content-Type: application/json" \
               -d "{
                 \"embeds\": [
                   {
                     \"title\": \"$EMOJI $ACTION_TEXT\",
                     \"description\": \"**#$ISSUE_NUMBER: $ISSUE_TITLE**\",
                     \"color\": $COLOR,
                     \"fields\": [
                       {
                         \"name\": \"ğŸ‘¤ ä½œæˆè€…\",
                         \"value\": \"$USER\",
                         \"inline\": true
                       },
                       {
                         \"name\": \"ğŸ”— ãƒªãƒ³ã‚¯\",
                         \"value\": \"[Issue #$ISSUE_NUMBER ã‚’è¦‹ã‚‹]($ISSUE_URL)\",
                         \"inline\": true
                       }
                     ],
                     \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)\"
                   }
                 ]
               }" \
               $DISCORD_WEBHOOK

      - name: Pull Request Notifications
        if: github.event_name == 'pull_request'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_DEV }}
        run: |
          ACTION="${{ github.event.action }}"
          PR_TITLE="${{ github.event.pull_request.title }}"
          PR_NUMBER="${{ github.event.pull_request.number }}"
          PR_URL="${{ github.event.pull_request.html_url }}"
          USER="${{ github.event.pull_request.user.login }}"
          BRANCH="${{ github.event.pull_request.head.ref }}"
          
          case "$ACTION" in
            "opened")
              EMOJI="ğŸ”€"
              ACTION_TEXT="æ–°ã—ã„PRãŒä½œæˆã•ã‚Œã¾ã—ãŸ"
              COLOR=3447003
              ;;
            "closed")
              if [ "${{ github.event.pull_request.merged }}" = "true" ]; then
                EMOJI="ğŸ‰"
                ACTION_TEXT="PRãŒãƒãƒ¼ã‚¸ã•ã‚Œã¾ã—ãŸ"
                COLOR=5763719
              else
                EMOJI="ğŸš«"
                ACTION_TEXT="PRãŒã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã—ãŸ"
                COLOR=15158332
              fi
              ;;
            "reopened")
              EMOJI="ğŸ”„"
              ACTION_TEXT="PRãŒå†ã‚ªãƒ¼ãƒ—ãƒ³ã•ã‚Œã¾ã—ãŸ"
              COLOR=3447003
              ;;
            "ready_for_review")
              EMOJI="ğŸ‘€"
              ACTION_TEXT="PRãŒãƒ¬ãƒ“ãƒ¥ãƒ¼æº–å‚™å®Œäº†ã«ãªã‚Šã¾ã—ãŸ"
              COLOR=10181046
              ;;
          esac
          
          curl -H "Content-Type: application/json" \
               -d "{
                 \"embeds\": [
                   {
                     \"title\": \"$EMOJI $ACTION_TEXT\",
                     \"description\": \"**#$PR_NUMBER: $PR_TITLE**\",
                     \"color\": $COLOR,
                     \"fields\": [
                       {
                         \"name\": \"ğŸ‘¤ ä½œæˆè€…\",
                         \"value\": \"$USER\",
                         \"inline\": true
                       },
                       {
                         \"name\": \"ğŸŒ¿ ãƒ–ãƒ©ãƒ³ãƒ\",
                         \"value\": \"\`$BRANCH\`\",
                         \"inline\": true
                       },
                       {
                         \"name\": \"ğŸ”— ãƒªãƒ³ã‚¯\",
                         \"value\": \"[PR #$PR_NUMBER ã‚’è¦‹ã‚‹]($PR_URL)\",
                         \"inline\": true
                       }
                     ],
                     \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)\"
                   }
                 ]
               }" \
               $DISCORD_WEBHOOK

      - name: PR Review Notifications
        if: github.event_name == 'pull_request_review'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_DEV }}
        run: |
          REVIEW_STATE="${{ github.event.review.state }}"
          PR_TITLE="${{ github.event.pull_request.title }}"
          PR_NUMBER="${{ github.event.pull_request.number }}"
          PR_URL="${{ github.event.pull_request.html_url }}"
          REVIEWER="${{ github.event.review.user.login }}"
          
          case "$REVIEW_STATE" in
            "approved")
              EMOJI="âœ…"
              ACTION_TEXT="PRãŒæ‰¿èªã•ã‚Œã¾ã—ãŸ"
              COLOR=5763719
              ;;
            "changes_requested")
              EMOJI="ğŸ”„"
              ACTION_TEXT="PRã«å¤‰æ›´ãŒè¦æ±‚ã•ã‚Œã¾ã—ãŸ"
              COLOR=15844367
              ;;
            "commented")
              EMOJI="ğŸ’¬"
              ACTION_TEXT="PRã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ"
              COLOR=3447003
              ;;
          esac
          
          curl -H "Content-Type: application/json" \
               -d "{
                 \"embeds\": [
                   {
                     \"title\": \"$EMOJI $ACTION_TEXT\",
                     \"description\": \"**#$PR_NUMBER: $PR_TITLE**\",
                     \"color\": $COLOR,
                     \"fields\": [
                       {
                         \"name\": \"ğŸ‘¤ ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼\",
                         \"value\": \"$REVIEWER\",
                         \"inline\": true
                       },
                       {
                         \"name\": \"ğŸ”— ãƒªãƒ³ã‚¯\",
                         \"value\": \"[PR #$PR_NUMBER ã‚’è¦‹ã‚‹]($PR_URL)\",
                         \"inline\": true
                       }
                     ],
                     \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)\"
                   }
                 ]
               }" \
               $DISCORD_WEBHOOK

      - name: Release Notifications
        if: github.event_name == 'release'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_DEV }}
        run: |
          RELEASE_NAME="${{ github.event.release.name }}"
          RELEASE_TAG="${{ github.event.release.tag_name }}"
          RELEASE_URL="${{ github.event.release.html_url }}"
          USER="${{ github.event.release.author.login }}"
          
          curl -H "Content-Type: application/json" \
               -d "{
                 \"embeds\": [
                   {
                     \"title\": \"ğŸ‰ æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸ\",
                     \"description\": \"**$RELEASE_NAME** (\`$RELEASE_TAG\`)\",
                     \"color\": 5763719,
                     \"fields\": [
                       {
                         \"name\": \"ğŸ‘¤ ä½œæˆè€…\",
                         \"value\": \"$USER\",
                         \"inline\": true
                       },
                       {
                         \"name\": \"ğŸ”— ãƒªãƒ³ã‚¯\",
                         \"value\": \"[ãƒªãƒªãƒ¼ã‚¹ã‚’è¦‹ã‚‹]($RELEASE_URL)\",
                         \"inline\": true
                       }
                     ],
                     \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)\"
                   }
                 ]
               }" \
               $DISCORD_WEBHOOK
